@inject EHRApplication.Services.IListService ListService
    @model EHRApplication.ViewModels.PortalViewModel;
@{
    ViewData["Title"] = "myEHR | Edit Visit";
    <link rel="stylesheet" href="~/css/forms.css">

    <script src="~/js/validation.js"></script>
}

<section class="my-5 w-75" data-bs-theme="auto">

    <div class="card-header" data-bs-theme="auto">
        <h3 class="my-3">Edit Visit</h3>
    </div>

    <div class="card-body" data-bs-theme="auto">
        <form method="post" id="visitForm" enctype="multipart/form-data">

            <!--These are here and hidden so so that when the form is submitted it will take the data that was used to populate
                the form and re use that. none of this data is allowed to be changed by the user.
            -->
            <input asp-for="Visit.MHN" hidden/>
            <input asp-for="Visit.visitsId" hidden/>
            <input asp-for="Visit.date" hidden/>
            <input asp-for="Visit.time" hidden/>

            <div class="form-group">
                <label for="providerId">Provider:</label>
                <select asp-for="Visit.providerId" id="providerId" class="form-control" name="Visit.providerId" data-bs-theme="auto">
                    <option value=""></option>
                    @foreach (var provider in ListService.GetProviders())
                    {
                        <option value="@provider.providerId.ToString()">
                            @provider.firstName @provider.lastName, @provider.specialty @provider.providerId
                        </option>
                    }
                </select>
                <span asp-validation-for="Visit.providerId" id="PrimaryPhysicianError" class="validation-msg"></span>
            </div>

            <div class="form-group">
                <label for="notes">Notes:</label>
                <input type="text" asp-for="Visit.notes" id="notes" name="Visit.notes" class="form-control" data-bs-theme="auto" onblur="validateRequiredTextInput('notes', 100, 'notes')" />
                <span asp-validation-for="Visit.notes" id="notesError" class="validation-msg"></span>
            </div>

            <!-- Submit Button -->
            <div class="mt-3 d-flex justify-content-center">
                <a type="button" class="btn btn-secondary me-2" value="Cancel" onclick="window.history.back()">Cancel</a>
                <input type="button" class="btn blue-button" data-bs-toggle="modal" data-bs-target="#confirmModal" value="Save" />
            </div>

            <!-- confirmation modal-->
            <div class="modal fade" id="confirmModal" tabindex="-1" aria-labelledby="ConfirmModalLabel" aria-hidden="true" data-bs-theme="auto">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="ConfirmModalLabel">Confirm</h5>
                            <button type="button" class="btn-close" data-bs-theme="auto" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            Are you sure you want to save the visit information?
                        </div>
                        <div class="modal-footer">
                            <button id="cancelButton" type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                            <button type="submit" class="btn blue-button" id="confirmBtn">Save</button>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>
</section>