@inject EHRApplication.Services.IListService ListService
@model PatientDemographic
@{
    ViewData["Title"] = "myEHR | Edit Patient";
    <link rel="stylesheet" href="~/css/forms.css">
    <script src="~/js/validation.js"></script>
    <script src="~/js/confirmModal.js"defer></script>
}

@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success">
        @TempData["SuccessMessage"]
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}

<section class="my-5 w-75" data-bs-theme="auto">

    <div class="card-header" data-bs-theme="auto">
        <h3 class="my-3">Edit Patient</h3>
    </div>

    <div class="card-body" data-bs-theme="auto">
        <form method="post" id="patientForm" enctype="multipart/form-data">

            <!-- First Name -->
            <div class="form-group">
                <label for="FirstName">First Name:</label>
                <input asp-for="firstName" type="text" id="FirstName" name="FirstName" class="form-control" value="@Model.firstName" data-bs-theme="auto" onblur="validateRequiredTextInput('FirstName', 25, 'first name')" />
                <span asp-validation-for="firstName" id="FirstNameError" class="validation-msg"></span>
            </div>

            <!-- Middle Name -->
            <div class="form-group">
                <label for="MiddleName">Middle Name (if applicable):</label>
                <input asp-for="middleName" type="text" id="MiddleName" name="MiddleName" class="form-control" value="@Model.middleName" data-bs-theme="auto" onblur="validateOptionalTextInput('MiddleName', 25, 'middle name')" />
                <span asp-validation-for="middleName" id="MiddleNameError" class="validation-msg"></span>
            </div>

            <!-- Last Name -->
            <div class="form-group">
                <label for="LastName">Last Name:</label>
                <input asp-for="lastName" type="text" id="LastName" name="LastName" class="form-control" value="@Model.lastName" data-bs-theme="auto" onblur="validateRequiredTextInput('LastName', 25,'last name')" />
                <span asp-validation-for="lastName" id="LastNameError" class="validation-msg"></span>
            </div>

            <!-- Suffix -->
            <div class="form-group">
                <label for="Suffix">Suffix (if applicable):</label>
                <input asp-for="suffix" type="text" id="Suffix" name="Suffix" class="form-control" value="@Model.suffix" data-bs-theme="auto" onblur="validateOptionalTextInput('Suffix', 20,  'suffix')" />
                <span asp-validation-for="suffix" id="SuffixError" class="validation-msg"></span>
            </div>

            <!-- Previous Name -->
            <div class="form-group">
                <label for="PreviousName">Previous Name (if applicable):</label>
                <input asp-for="previousName" type="text" id="PreviousName" name="PreviousName" class="form-control" value="@Model.previousName" data-bs-theme="auto" onblur="validateOptionalTextInput('PreviousName', 60,  'previous name')" />
                <span asp-validation-for="previousName" id="PreviousNameError" class="validation-msg"></span>
            </div>

            <!-- Date of Birth -->
            <div class="form-group">
                <label asp-for="DOB">Date of Birth:</label>
                <input asp-for="DOB" type="date" id="DOB" class="form-control" value="@Model.DOB.ToString("yyyy-MM-dd")" onblur="validateDatePicker('DOB', 'date of birth')" data-bs-theme="auto" required/>
                <span asp-validation-for="DOB" id="DOBError" class="validation-msg"></span>
            </div>

            <!-- Primary Physician -->
            <div class="form-group">
                <label for="PrimaryPhysician">Primary Physician:</label>
                <select id="primaryPhysician" class="form-control" name="primaryPhysician" asp-for="primaryPhysician" data-bs-theme="auto">
                    <option value=""></option>
                    @foreach (var provider in ListService.GetProviders())
                    {
                        <option value="@provider.providerId.ToString()">
                            @provider.firstName @provider.lastName, @provider.specialty @provider.providerId
                        </option>
                    }
                </select>
                <span asp-validation-for="primaryPhysician" id="PrimaryPhysicianError" class="validation-msg"></span>
            </div>

            <!-- Legal Guardian 1 -->
            <div class="form-group">
                <label for="LegalGuardian1">Legal Guardian 1 (if applicable):</label>
                <input asp-for="legalGuardian1" type="text" id="LegalGuardian1" name="LegalGuardian1" class="form-control" value="@Model.legalGuardian1" data-bs-theme="auto" onblur="validateOptionalTextInput('LegalGuardian1', 100, 'legal guardian')" />
                <span asp-validation-for="legalGuardian1" id="LegalGuardian1Error" class="validation-msg"></span>
            </div>

            <!-- Legal Guardian 2 -->
            <div class="form-group">
                <label for="LegalGuardian2">Legal Guardian 2 (if applicable):</label>
                <input asp-for="legalGuardian2" type="text" id="LegalGuardian2" name="LegalGuardian2" class="form-control" value="@Model.legalGuardian2" data-bs-theme="auto" onblur="validateOptionalTextInput('LegalGuardian2', 100, 'legal guardian')" />
                <span asp-validation-for="legalGuardian2" id="LegalGuardian2Error" class="validation-msg"></span>
            </div>

            <!-- Religion -->
            <div class="form-group">
                <label for="Religion">Religion (optional):</label>
                <input asp-for="religion" type="text" id="Religion" name="Religion" class="form-control" value="@Model.religion" data-bs-theme="auto" onblur="validateOptionalTextInput('Religion', 100,  'religion')" />
                <span asp-validation-for="religion" id="ReligionError" class="validation-msg"></span>
            </div>

            <div class="form-group">
                <label for="Pronouns">Preferred Pronouns:</label>
                <select asp-for="preferredPronouns" id="Pronouns" name="preferredPronouns" class="form-control" data-bs-theme="auto" required onchange="dropdownOtherOption('Pronouns', 'OtherPronouns', 'OtherPronounsError', 'pronoun')">
                    <option value=""></option>
                    <option value="He/Him">He/Him</option>
                    <option value="She/Her">She/Her</option>
                    <option value="They/Them">They/Them</option>
                    <option value="Other">Other</option>
                </select>
                <input asp-for="OtherPronouns" type="text" id="OtherPronouns" name="OtherPronouns" class="form-control" style="display: none;" data-bs-theme="auto" />
                <span asp-validation-for="OtherPronouns" id="OtherPronounsError" class="validation-msg"></span>
            </div>

            <div class="form-group">
                <label for="Gender">Gender:</label>
                <select asp-for="gender" id="Gender" name="Gender" class="form-control" data-bs-theme="auto" required onchange="dropdownOtherOption('Gender', 'OtherGender', 'OtherGenderError', 'gender')">
                    <option value=""></option>
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                    <option value="Non-binary">Non-binary</option>
                    <option value="Other">Other</option>
                </select>
                <input asp-for="OtherGender" type="text" id="OtherGender" class="form-control" style="display: none;" data-bs-theme="auto" />
                <span asp-validation-for="OtherGender" id="OtherGenderError" class="validation-msg"></span>
            </div>


            <div class="form-group">
                <label for="GenderAssignedAtBirth">Gender assigned at birth:</label>
                <select asp-for="genderAssignedAtBirth" id="GenderAssignedAtBirth" name="GenderAssignedAtBirth" class="form-control" data-bs-theme="auto">
                    <option value=""></option>
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                    <option value="Intersex">Intersex</option>
                </select>
                <span asp-validation-for="genderAssignedAtBirth" id="GenderAssignedAtBirthError" class="validation-msg"></span>
            </div>

            <div class="form-group">
                <label for="PreferredLanguage">Preferred Language:</label>
                <select asp-for="preferredLanguage" id="PreferredLanguage" name="PreferredLanguage" class="form-control" data-bs-theme="auto">
                    <option value=""></option>
                    <option value="English">English</option>
                    <option value="Arabic">Arabic</option>
                    <option value="Bengali">Bengali</option>
                    <option value="Dutch">Dutch</option>
                    <option value="French">French</option>
                    <option value="German">German</option>
                    <option value="Hindi">Hindi</option>
                    <option value="Hmong">Hmong</option>
                    <option value="Italian">Italian</option>
                    <option value="Japanese">Japanese</option>
                    <option value="Korean">Korean</option>
                    <option value="Mandarin">Mandarin</option>
                    <option value="Portuguese">Portuguese</option>
                    <option value="Russian">Russian</option>
                    <option value="Spanish">Spanish</option>
                </select>
                <span asp-validation-for="preferredLanguage" id="PreferredLanguageError" class="validation-msg"></span>
            </div>

            <!-- Ethnicity -->
            <div class="form-group">
                <label for="Ethnicity">Is the patient of Hispanic, Latino, or Spanish origin?</label>
                <div class="col-sm-6 ms-4">
                    <div class="race-column">
                        <input type="radio" id="Yes" name="Ethnicity" value="Hispanic" @(Model.ethnicity == "Hispanic" ? "checked" : "") />
                        <label for="Yes" style="font-weight: normal;">Yes</label><br />
                        <input type="radio" id="No" name="Ethnicity" value="Non-Hispanic" @(Model.ethnicity == "Non-Hispanic" ? "checked" : "") />
                        <label for="No" style="font-weight: normal;">No</label><br />
                        <input type="radio" id="Unknown" name="Ethnicity" value="Unknown" @(Model.ethnicity == "Unknown" ? "checked" : "") />
                        <label for="Unknown" style="font-weight: normal;">Unknown</label><br />
                    </div>
                </div>
                <span asp-validation-for="ethnicity" id="EthnicityError" class="validation-msg"></span>
            </div>

            <!-- Race -->
            <div class="form-group">
                <label for="Race" class="mb-1">Race:</label>
                <div asp-for="raceList" id="Race" class="row text-nowrap">
                    <div class="col-sm-6 ms-4">
                        <div class="race-column">
                            <input type="checkbox" id="AmericanIndian" name="RaceList" value="American Indian or Alaska Native" @(Model.race != null && Model.race.Contains("American Indian or Alaska Native") ? "checked" : "") />
                            <label for="AmericanIndianOrAlaskaNative" style="font-weight: normal;">American Indian or Alaska Native</label><br />

                            <input type="checkbox" id="Asian" name="RaceList" value="Asian" @(Model.race != null && Model.race.Contains("Asian") ? "checked" : "") />
                            <label for="Asian" style="font-weight: normal;">Asian</label><br />

                            <input type="checkbox" id="Black" name="RaceList" value="Black or African American" @(Model.race != null && Model.race.Contains("black or African American") ? "checked" : "") />
                            <label for="BlackOrAfricanAmerican" style="font-weight: normal;">Black or African American</label><br />

                            <input type="checkbox" id="PacificIslander" name="RaceList" value="Native Hawaiian or Other Pacific Islander" @(Model.race != null && Model.race.Contains("Native Hawaiian or Other Pacific Islander") ? "checked" : "") />
                            <label for="NativeHawaiianrOrOtherPacificIslander" style="font-weight: normal;">Native Hawaiian or Other Pacific Islander</label><br />

                            <input type="checkbox" id="White" name="RaceList" value="White" @(Model.race != null && Model.race.Contains("White") ? "checked" : "") />
                            <label for="White" style="font-weight: normal;">White</label><br />

                            <input type="checkbox" id="OtherRace" name="RaceList" value="Other" onchange="otherRaceInput()" @(Model.race != null && Model.race.Contains("Other") ? "checked" : "") />
                            <label for="OtherRace" style="font-weight: normal;">Other</label><br />
                        </div>
                    </div><br />
                </div>
                <span asp-validation-for="raceList" id="RaceError" class="validation-msg"></span>
            </div>
            <div>
                <input asp-for="OtherRace" type="text" id="OtherRaceInput" value="@Model.OtherRace" name="OtherRace" class="form-control" style="display: none;" data-bs-theme="auto" placeholder="Please specify a race." />
                <span asp-validation-for="OtherRace" id="OtherRaceInputError" class="validation-msg"></span>
            </div>

            <!-- Patient Image -->
            <div class="form-group">
                <label for="patientImageFile" class="mb-1">Patient Image (Optional):</label>
                <small>Please select an image file of type .jpg or .png.</small>
                <input asp-for="patientImageFile" type="file" id="patientImageFile" name="PatientImageFile" class="form-control" data-bs-theme="auto" onchange="validateImageFile('patientImageFile', 'PatientImageFileError')"
                       value="@if(!string.IsNullOrEmpty(Model.patientImage))
                       {
                           <text>value="@Model.patientImage"</text>
                       }"
                       />
                <span asp-validation-for="patientImage" id="PatientImageFileError" class="validation-msg"></span>
            </div>


            <!-- Submit Button -->
            <div class="mt-3 d-flex justify-content-center">
                <a type="button"  class="btn btn-secondary me-2" asp-controller="Patient" asp-action="AllPatients">Cancel</a>
                <input type="button" class="btn blue-button" data-bs-toggle="modal" data-bs-target="#confirmModal"  value="Save" />
            </div>

            <!-- confirmation modal-->
            <div class="modal fade" id="confirmModal" tabindex="-1" aria-labelledby="ConfirmModalLabel" aria-hidden="true" data-bs-theme="auto">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="ConfirmModalLabel">Confirm</h5>
                            <button type="button" class="btn-close" data-bs-theme="auto" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            Are you sure you want to save patient information?
                        </div>
                        <div class="modal-footer">
                            <button id="cancelButton" type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                            <button type="submit" class="btn blue-button" id="confirmBtn">Save</button>
                        </div>
                    </div>
                </div>
            </div>

        </form>
    </div>
</section>

